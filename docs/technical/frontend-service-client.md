# å‰ç«¯æœåŠ¡å®¢æˆ·ç«¯(Frontend Service Client)

## ğŸ“‹ æ¦‚è¿°

å‰ç«¯æœåŠ¡å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªè®©å‰ç«¯ä»£ç è°ƒç”¨è¿œç¨‹æœåŠ¡å¦‚åŒè°ƒç”¨æœ¬åœ°æ–¹æ³•çš„ç³»ç»Ÿã€‚å®ƒé€šè¿‡ä»£ç†æ¨¡å¼å’Œçº¦å®šï¼Œå°†HTTPè¯·æ±‚æŠ½è±¡æˆç±»å‹å®‰å…¨çš„æ–¹æ³•è°ƒç”¨ï¼Œæ¶ˆé™¤å‰ç«¯ä¸åç«¯é€šä¿¡çš„å¤æ‚æ€§ã€‚

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### ä»€ä¹ˆæ˜¯å‰ç«¯æœåŠ¡å®¢æˆ·ç«¯ï¼Ÿ

å‰ç«¯æœåŠ¡å®¢æˆ·ç«¯ä¸æ˜¯ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰ï¼Œè€Œæ˜¯ä¸€ä¸ª**RPCä»£ç†ç³»ç»Ÿ**ï¼Œç›®æ ‡æ˜¯ï¼š

1. **æ¶ˆé™¤HTTPå¤æ‚æ€§** - å‰ç«¯å¼€å‘è€…æ— éœ€å¤„ç†fetchã€é”™è¯¯å¤„ç†ã€åºåˆ—åŒ–ç­‰
2. **æä¾›ç±»å‹å®‰å…¨** - é€šè¿‡TypeScriptæ¥å£ç¡®ä¿è°ƒç”¨çš„æ­£ç¡®æ€§
3. **ç»Ÿä¸€è°ƒç”¨ä½“éªŒ** - è¿œç¨‹è°ƒç”¨å’Œæœ¬åœ°è°ƒç”¨çœ‹èµ·æ¥ä¸€æ ·

### æ ¸å¿ƒæ€æƒ³

```typescript
// ä¼ ç»Ÿæ–¹å¼ï¼šæ‰‹å·¥HTTPè°ƒç”¨
const response = await fetch('/api/chat/messages', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ query: 'hello' })
})
const data = await response.json()

// æœåŠ¡å®¢æˆ·ç«¯ï¼šç›´æ¥æ–¹æ³•è°ƒç”¨
const messages = await chatService.getMessages('hello')
```

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### 1. æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å‰ç«¯ä¸šåŠ¡å±‚                 â”‚
â”‚    (Vueç»„ä»¶/Reactç»„ä»¶/çº¯JSé€»è¾‘)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ ç›´æ¥æ–¹æ³•è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æœåŠ¡å®¢æˆ·ç«¯ä»£ç†å±‚              â”‚
â”‚    (createServiceClientç”Ÿæˆçš„ä»£ç†)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTPè¯·æ±‚/SSEè¿æ¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ç½‘ç»œä¼ è¾“å±‚               â”‚
â”‚        (fetch/EventSource)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTP/SSEåè®®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             åç«¯æœåŠ¡                â”‚
â”‚      (LadySion Backend API)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ ¸å¿ƒç»„ä»¶

#### ServiceClientç”Ÿæˆå™¨
- **èŒè´£**ï¼šæ ¹æ®æœåŠ¡æ¥å£ç”Ÿæˆå®¢æˆ·ç«¯ä»£ç†
- **è¾“å…¥**ï¼šæœåŠ¡æ¥å£ç±» + é…ç½®é€‰é¡¹
- **è¾“å‡º**ï¼šç±»å‹å®‰å…¨çš„æœåŠ¡ä»£ç†å¯¹è±¡

#### HTTPè°ƒç”¨å¤„ç†å™¨
- **èŒè´£**ï¼šå¤„ç†æ™®é€šæ–¹æ³•çš„HTTPè¯·æ±‚
- **æ”¯æŒ**ï¼šGET/POSTè¯·æ±‚ã€é”™è¯¯å¤„ç†ã€è¶…æ—¶æ§åˆ¶

#### æµå¼è°ƒç”¨å¤„ç†å™¨
- **èŒè´£**ï¼šå¤„ç†æµå¼æ–¹æ³•çš„SSEè¿æ¥
- **æ£€æµ‹è§„åˆ™**ï¼šæ–¹æ³•ååŒ…å«"Stream"å…³é”®å­—
- **æ”¯æŒ**ï¼šEventSourceè¿æ¥ã€å®æ—¶æ•°æ®æµ

## ğŸ”§ æŠ€æœ¯è§„èŒƒ

### 1. æœåŠ¡æ¥å£çº¦å®š

æ¯ä¸ªæœåŠ¡å¿…é¡»ç»§æ‰¿BaseServiceå¹¶éµå¾ªçº¦å®šï¼š

```typescript
interface BaseService {
  readonly serviceName: string
}

interface ChatService extends BaseService {
  readonly serviceName: 'ChatService'
  
  // æ™®é€šHTTPæ–¹æ³•
  getMessages(query: string): Promise<ServiceResponse<Message[]>>
  
  // æµå¼æ–¹æ³•ï¼ˆåŒ…å«Streamå…³é”®å­—ï¼‰
  streamMessages(query: string): AsyncIterable<MessageChunk>
}
```

### 2. URLç”Ÿæˆè§„åˆ™

- **åŸºç¡€è·¯å¾„**ï¼š`/api/service-client/`
- **æœåŠ¡è·¯å¾„**ï¼š`{servicename}/`ï¼ˆå°å†™ï¼‰
- **æ–¹æ³•è·¯å¾„**ï¼š`{methodname}`
- **å®Œæ•´ä¾‹å­**ï¼š`/api/service-client/chatservice/getMessages`

### 3. è¯·æ±‚æ ¼å¼çº¦å®š

#### HTTPè¯·æ±‚
```json
{
  "method": "POST",
  "headers": {
    "Content-Type": "application/json"
  },
  "body": {
    "args": ["å‚æ•°1", "å‚æ•°2", "..."]
  }
}
```

#### æµå¼è¯·æ±‚
- ä½¿ç”¨EventSourceè¿æ¥
- URLå‚æ•°ä¼ é€’ï¼š`?args=["å‚æ•°1","å‚æ•°2"]`
- å®æ—¶æ¥æ”¶JSONæ•°æ®å—

### 4. å“åº”æ ¼å¼çº¦å®š

#### æˆåŠŸå“åº”
```typescript
interface ServiceResponse<T> {
  success: true
  data: T
  timestamp: Date
}
```

#### é”™è¯¯å“åº”
```typescript
interface ServiceResponse<T> {
  success: false
  error: string
  timestamp: Date
}
```

#### æµå¼å“åº”
```typescript
// æ¯ä¸ªSSEäº‹ä»¶åŒ…å«
interface StreamChunk {
  data: any  // ä¸šåŠ¡æ•°æ®
}
```

## ğŸ› ï¸ å®ç°åŸåˆ™

### 1. çº¦å®šä¼˜äºé…ç½®
- é€šè¿‡å‘½åçº¦å®šè‡ªåŠ¨æ£€æµ‹æµå¼æ–¹æ³•
- é€šè¿‡æœåŠ¡åè‡ªåŠ¨ç”ŸæˆURLè·¯å¾„
- æœ€å°åŒ–é…ç½®éœ€æ±‚

### 2. ç±»å‹å®‰å…¨ä¼˜å…ˆ
- å…¨ç¨‹TypeScriptç±»å‹æ£€æŸ¥
- ç¼–è¯‘æ—¶å‘ç°æ¥å£ä¸åŒ¹é…
- è‡ªåŠ¨è¡¥å…¨å’ŒIDEæ”¯æŒ

### 3. æ¸è¿›å¼å¢å¼º
- å¯ä»¥ä¸ä¼ ç»ŸHTTPè°ƒç”¨å…±å­˜
- æ”¯æŒè‡ªå®šä¹‰é…ç½®è¦†ç›–é»˜è®¤è¡Œä¸º
- æ”¯æŒä¸­é—´ä»¶æ‰©å±•

### 4. é”™è¯¯å¤„ç†é€æ˜
- ç½‘ç»œé”™è¯¯è‡ªåŠ¨è½¬æ¢ä¸ºå¤±è´¥å“åº”
- HTTPçŠ¶æ€ç é”™è¯¯ç»Ÿä¸€å¤„ç†
- ä¿æŒè°ƒç”¨æ–¹å¼çš„ç®€æ´æ€§

## ğŸ“‹ APIè®¾è®¡

### åˆ›å»ºæœåŠ¡å®¢æˆ·ç«¯

```typescript
function createServiceClient<T extends BaseService>(
  ServiceClass: new() => T,
  config?: ServiceClientConfig
): T

interface ServiceClientConfig {
  baseUrl?: string           // è‡ªå®šä¹‰APIåŸºç¡€URL
  timeout?: number          // è¯·æ±‚è¶…æ—¶æ—¶é—´(ms)
  headers?: Record<string, string>  // è‡ªå®šä¹‰è¯·æ±‚å¤´
}
```

### ä½¿ç”¨ç¤ºä¾‹

```typescript
// 1. å®šä¹‰æœåŠ¡æ¥å£
interface ChatService extends BaseService {
  readonly serviceName: 'ChatService'
  getMessages(query: string): Promise<ServiceResponse<Message[]>>
  streamChat(prompt: string): AsyncIterable<ChatChunk>
}

// 2. åˆ›å»ºå®¢æˆ·ç«¯
const chatClient = createServiceClient(ChatServiceImpl, {
  baseUrl: '/api',
  timeout: 10000,
  headers: { 'Authorization': 'Bearer token' }
})

// 3. ä½¿ç”¨å®¢æˆ·ç«¯
const messages = await chatClient.getMessages('hello')
for await (const chunk of chatClient.streamChat('tell me a story')) {
  console.log(chunk.content)
}
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•èŒƒå›´
- ä»£ç†å¯¹è±¡åˆ›å»ºå’Œæ–¹æ³•ç»‘å®š
- HTTPè¯·æ±‚æ ¼å¼å’Œé”™è¯¯å¤„ç†  
- æµå¼è¿æ¥å»ºç«‹å’Œæ•°æ®æ¥æ”¶
- é…ç½®é¡¹åº”ç”¨å’ŒURLç”Ÿæˆ

### 2. é›†æˆæµ‹è¯•èŒƒå›´
- ä¸çœŸå®åç«¯æœåŠ¡çš„é€šä¿¡
- ç«¯åˆ°ç«¯çš„æ•°æ®æµéªŒè¯
- æ€§èƒ½å’Œç¨³å®šæ€§æµ‹è¯•

### 3. æµ‹è¯•æ–‡ä»¶å‘½å
- ä½¿ç”¨ `.test.ts` åç¼€ï¼ˆJest/Vitestæ ‡å‡†ï¼‰
- æµ‹è¯•æ–‡ä»¶ä½äº `__tests__` ç›®å½•

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å‰ç«¯æ¶æ„è®¾è®¡](../architecture/frontend-architecture.md)
- [åç«¯APIè®¾è®¡](../architecture/backend-api.md)
- [ç±»å‹ç³»ç»Ÿè®¾è®¡](./typescript-contracts.md)

## ğŸ”„ æ›´æ–°è®°å½•

- 2024-12-26: åˆ›å»ºæ–‡æ¡£ï¼Œå®šä¹‰æ ¸å¿ƒæ¦‚å¿µå’Œæ¶æ„ 